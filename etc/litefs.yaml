data:
  dir: "/var/lib/litefs"

lease:
  type: "consul"
  candidate: ${FLY_REGION == PRIMARY_REGION}
  promote: true
  advertise-url: "http://${FLY_ALLOC_ID}.vm.${FLY_APP_NAME}.internal:20202"

  consul:
    url: "${FLY_CONSUL_URL}"
    key: "${FLY_APP_NAME}/primary"

proxy:
  addr: ":8080"
  target: "localhost:8000"
  db: "books.db"

exec:
  - cmd: "cp /deno-dir/src/databases/*.db /var/lib/litefs/"
  - cmd: "deno run -A ./server.ts"
